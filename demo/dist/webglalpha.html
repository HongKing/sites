<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"><title>alpha混合半透明物体</title><link rel="stylesheet" href="../css/main.css"><link rel="stylesheet" href="../css/fontello.css"><link rel="stylesheet" href="../css/style.css"></head><body><div class="content"><a class="github" href="https://github.com/edwardzhong"><img src="../img/github.png"></a><header class="header"><h1><a href="../index.html">Jeff Zhong's Demo</a></h1></header><div class="main grid"><a class="effect-list" href="../index.html">&larr;&nbsp;effect list</a><h2>alpha混合半透明物体</h2><canvas id="canvas" width="700" height="500"></canvas></div><footer class="footer"><p> Copyright &copy; 2017 <a href="https://github.com/edwardzhong">Jeff Zhong</a></p></footer></div><script>(function(){'use strict';var ce=Math.floor,le=Math.sin,me=Math.cos,pe=Math.PI,Te=Math.sqrt;function e(e,t,r){const i=new ve(3);return e&&(i[0]=e),t&&(i[1]=t),r&&(i[2]=r),i}function t(e,t,r){return r=r||new ve(3),r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r}function r(e,t,r){r=r||new ve(3);const i=e[2]*t[0]-e[0]*t[2],n=e[0]*t[1]-e[1]*t[0];return r[0]=e[1]*t[2]-e[2]*t[1],r[1]=i,r[2]=n,r}function i(e,t){t=t||new ve(3);const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=Te(r);return 1e-5<i?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=0,t[1]=0,t[2]=0),t}function n(e){return e=e||new Ee(16),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function o(e,t){t=t||new Ee(16);const r=e[0],i=e[1],n=e[2],o=e[3],a=e[4],s=e[5],u=e[6],_=e[7],f=e[8],c=e[9],l=e[10],m=e[11],p=e[12],T=e[13],v=e[14],E=e[15],x=l*E,h=v*m,y=u*E,A=v*_,S=u*m,z=l*_,L=n*E,N=v*o,C=n*m,R=l*o,I=n*_,O=u*o,F=f*T,B=p*c,P=a*T,V=p*s,M=a*c,D=f*s,U=r*T,w=p*i,G=r*c,X=f*i,k=r*s,W=a*i,H=x*s+A*c+S*T-(h*s+y*c+z*T),Y=h*i+L*c+R*T-(x*i+N*c+C*T),j=y*i+N*s+I*T-(A*i+L*s+O*T),q=z*i+C*s+O*c-(S*i+R*s+I*c),K=1/(r*H+a*Y+f*j+p*q);return t[0]=K*H,t[1]=K*Y,t[2]=K*j,t[3]=K*q,t[4]=K*(h*a+y*f+z*p-(x*a+A*f+S*p)),t[5]=K*(x*r+N*f+C*p-(h*r+L*f+R*p)),t[6]=K*(A*r+L*a+O*p-(y*r+N*a+I*p)),t[7]=K*(S*r+R*a+I*f-(z*r+C*a+O*f)),t[8]=K*(F*_+V*m+M*E-(B*_+P*m+D*E)),t[9]=K*(B*o+U*m+X*E-(F*o+w*m+G*E)),t[10]=K*(P*o+w*_+k*E-(V*o+U*_+W*E)),t[11]=K*(D*o+G*_+W*m-(M*o+X*_+k*m)),t[12]=K*(P*l+D*v+B*u-(M*v+F*u+V*l)),t[13]=K*(G*v+F*n+w*l-(U*l+X*v+B*n)),t[14]=K*(U*u+W*v+V*n-(k*v+P*n+w*u)),t[15]=K*(k*l+M*n+X*u-(G*u+W*l+D*n)),t}function a(e,t,r){r=r||new Ee(16);const i=e[0],n=e[1],o=e[2],a=e[3],s=e[4],u=e[5],_=e[6],d=e[7],f=e[8],c=e[9],l=e[10],m=e[11],p=e[12],T=e[13],v=e[14],E=e[15],x=t[0],h=t[1],y=t[2],A=t[3],S=t[4],z=t[5],L=t[6],N=t[7],C=t[8],R=t[9],I=t[10],O=t[11],F=t[12],B=t[13],P=t[14],V=t[15];return r[0]=i*x+s*h+f*y+p*A,r[1]=n*x+u*h+c*y+T*A,r[2]=o*x+_*h+l*y+v*A,r[3]=a*x+d*h+m*y+E*A,r[4]=i*S+s*z+f*L+p*N,r[5]=n*S+u*z+c*L+T*N,r[6]=o*S+_*z+l*L+v*N,r[7]=a*S+d*z+m*L+E*N,r[8]=i*C+s*R+f*I+p*O,r[9]=n*C+u*R+c*I+T*O,r[10]=o*C+_*R+l*I+v*O,r[11]=a*C+d*R+m*I+E*O,r[12]=i*F+s*B+f*P+p*V,r[13]=n*F+u*B+c*P+T*V,r[14]=o*F+_*B+l*P+v*V,r[15]=a*F+d*B+m*P+E*V,r}function s(e,t,r,i,n){var o=Math.tan;n=n||new Ee(16);const a=o(.5*pe-.5*e),s=1/(r-i);return n[0]=a/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=a,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=(r+i)*s,n[11]=-1,n[12]=0,n[13]=0,n[14]=2*(r*i*s),n[15]=0,n}function u(e,n,o,a){a=a||new Ee(16);const s=xe,u=he,_=ye;return i(t(e,n,_),_),i(r(o,_,s),s),i(r(_,s,u),u),a[0]=s[0],a[1]=s[1],a[2]=s[2],a[3]=0,a[4]=u[0],a[5]=u[1],a[6]=u[2],a[7]=0,a[8]=_[0],a[9]=_[1],a[10]=_[2],a[11]=0,a[12]=e[0],a[13]=e[1],a[14]=e[2],a[15]=1,a}function _(e,t){return t=t||new Ee(16),t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function d(e,t,r){r=r||new Ee(16);const i=e[0],n=e[1],o=e[2],a=e[3],u=e[8],_=e[9],d=e[10],f=e[11],l=me(t),c=le(t);return r[0]=l*i-c*u,r[1]=l*n-c*_,r[2]=l*o-c*d,r[3]=l*a-c*f,r[8]=l*u+c*i,r[9]=l*_+c*n,r[10]=l*d+c*o,r[11]=l*f+c*a,e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r}function f(t,r,i){i=i||e();const n=r[0],o=r[1],a=r[2],s=n*t[3]+o*t[7]+a*t[11]+t[15];return i[0]=(n*t[0]+o*t[4]+a*t[8]+t[12])/s,i[1]=(n*t[1]+o*t[5]+a*t[9]+t[13])/s,i[2]=(n*t[2]+o*t[6]+a*t[10]+t[14])/s,i}function c(){var e=ce(360*Math.random()),t=ce(50*Math.random()+50),r=ce(20*Math.random()+40);return[e,t,r]}function l(e){var n=Math.ceil,o=parseFloat(e[0]/360,10),a=parseFloat(e[1]/100,10),s=parseFloat(e[2]/100,10);if(0==a){var u=g=b=n(255*s);return[u,g,b]}for(var r,_=.5<=s?s+a-s*a:s*(1+a),d=2*s-_,f=[1/3,0,-1/3],c=0;3>c;c++)r=o+f[c],0>r&&(r+=1),1<r&&(r-=1),r=1>6*r?d+6*(_-d)*r:1>2*r?_:2>3*r?d+6*((_-d)*(2/3-r)):d,f[c]=n(255*r);return f}function m(e){return[e[0]/255,e[1]/255,e[2]/255,e[3]||1]}function p(e,t){t=t||window.devicePixelRatio;var r=e.width,i=e.height,n=ce(e.clientWidth*t),o=ce(e.clientHeight*t);(r!==n||i!==o)&&(e.width=n,e.height=o,e.style.width=r+"px",e.style.height=i+"px")}function T(e){return{position:[-e,0,-e,-e,0,e,e,0,-e,e,0,-e,-e,0,e,e,0,e,e,0,-e,-e,0,e,-e,0,-e,e,0,e,-e,0,e,e,0,-e],normal:[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],texcoord:[0,1,0,0,1,1,1,1,0,0,1,0,1,1,0,0,0,1,1,0,0,0,1,1]}}function v(e){e=e||1;var t=[-e,-e,-e,-e,e,-e,e,-e,-e,-e,e,-e,e,e,-e,e,-e,-e,-e,-e,e,e,-e,e,-e,e,e,-e,e,e,e,-e,e,e,e,e,-e,e,-e,-e,e,e,e,e,-e,-e,e,e,e,e,e,e,e,-e,-e,-e,-e,e,-e,-e,-e,-e,e,-e,-e,e,e,-e,-e,e,-e,e,-e,-e,-e,-e,-e,e,-e,e,-e,-e,-e,e,-e,e,e,-e,e,-e,e,-e,-e,e,e,-e,e,-e,e,e,-e,e,e,e,-e,e,e,e];return{position:t,normal:[0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0]}}function E(e,t,n){e=e||1,t=t||1,n=n||3;for(var o=[],a=[],s=[],u=2*pe/n,_=0,d=0,f=6,c=0;c<n;c++)_=e*me(u*c),d=e*le(u*c),o.push(_,t/2,d),o.push(_,-t/2,d);for(var c=0,m=o.length;c<m;c+=f){var p=(c+6)%m,T=(c+7)%m,v=(c+8)%m,E=(c+9)%m,y=(c+10)%m,S=(c+11)%m;a.push(0,t/2,0),a.push(o[p],o[T],o[v]),a.push(o[c],o[c+1],o[c+2]),s.push(0,1,0,0,1,0,0,1,0),a.push(o[c],o[c+1],o[c+2]),a.push(o[p],o[T],o[v]),a.push(o[c+3],o[c+4],o[c+5]),s=s.concat(A([o[c],t/2,o[c+2]])),s=s.concat(A([o[p],t/2,o[v]])),s=s.concat(A([o[c+3],-t/2,o[c+5]])),a.push(o[c+3],o[c+4],o[c+5]),a.push(o[p],o[T],o[v]),a.push(o[E],o[y],o[S]),s=s.concat(A([o[c+3],-t/2,o[c+5]])),s=s.concat(A([o[p],t/2,o[v]])),s=s.concat(A([o[E],-t/2,o[S]])),a.push(0,-t/2,0),a.push(o[c+3],o[c+4],o[c+5]),a.push(o[E],o[y],o[S]),s.push(0,-1,0,0,-1,0,0,-1,0)}return o=null,{position:a,normal:s}}function x(e,t,n){e=e||1,t=t||1,n=n||3;for(var o=[],a=[],s=[],u=2*pe/n,_=0,d=e*e/t,f=0,c=3,m=0;m<n;m++)_=e*me(u*m),f=e*le(u*m),o.push(_,-t/2,f);for(var m=0,p=o.length;m<p;m+=c){var T=(m+3)%p,v=(m+4)%p,E=(m+5)%p;a.push(0,t/2,0),a.push(o[T],o[v],o[E]),a.push(o[m],o[m+1],o[m+2]),s.push(0,1,0),s=s.concat(A([o[T],d,o[E]])),s=s.concat(A([o[m],d,o[m+2]])),a.push(0,-t/2,0),a.push(o[m],o[m+1],o[m+2]),a.push(o[T],o[v],o[E]),s.push(0,-1,0,0,-1,0,0,-1,0)}return o=null,{position:a,normal:s}}function h(e,t){e=e||1,t=t||15;for(var n,o,a,s,u,_,d=[],f=[],c=[],m=0;m<=t;m++){s=m*pe/t,_=e*le(s),o=e*me(s);for(var p=0;p<=t;p++)u=2*p*pe/t,n=le(u)*_,a=me(u)*_,d.push(n,o,a)}for(m=0;m<t;m++)for(p=0;p<t;p++){var T=m*(t+1)+p,v=T+t+1;f.push(d[3*T],d[3*T+1],d[3*T+2]),f.push(d[3*v],d[3*v+1],d[3*v+2]),f.push(d[3*(T+1)],d[3*(T+1)+1],d[3*(T+1)+2]),f.push(d[3*(T+1)],d[3*(T+1)+1],d[3*(T+1)+2]),f.push(d[3*v],d[3*v+1],d[3*v+2]),f.push(d[3*(v+1)],d[3*(v+1)+1],d[3*(v+1)+2]),c=c.concat(A([d[3*T],d[3*T+1],d[3*T+2]])),c=c.concat(A([d[3*v],d[3*v+1],d[3*v+2]])),c=c.concat(A([d[3*(T+1)],d[3*(T+1)+1],d[3*(T+1)+2]])),c=c.concat(A([d[3*(T+1)],d[3*(T+1)+1],d[3*(T+1)+2]])),c=c.concat(A([d[3*v],d[3*v+1],d[3*v+2]])),c=c.concat(A([d[3*(v+1)],d[3*(v+1)+1],d[3*(v+1)+2]]))}return d=null,{position:f,normal:c}}function A(t){var r=t[0],i=t[1],n=t[2],e=Te(r*r+i*i+n*n);return e?1==e?t:(e=1/e,t[0]=r*e,t[1]=i*e,t[2]=n*e,t):(t[0]=0,t[1]=0,t[2]=0,t)}function S(e){return He[e].bindPoint}function z(e,t){return function(r){e.uniform1i(t,r)}}function L(e,t){return function(r){e.uniform1iv(t,r)}}function N(e,t){return function(r){e.uniform2iv(t,r)}}function C(e,t){return function(r){e.uniform3iv(t,r)}}function R(e,t){return function(r){e.uniform4iv(t,r)}}function I(e,t,r,i){const n=S(t);return D(e)?function(t){let o,a;M(e,t)?(o=t,a=null):(o=t.texture,a=t.sampler),e.uniform1i(i,r),e.activeTexture(e.TEXTURE0+r),e.bindTexture(n,o),e.bindSampler(r,a)}:function(t){e.uniform1i(i,r),e.activeTexture(e.TEXTURE0+r),e.bindTexture(n,t)}}function O(e,t,r,i,n){const o=S(t),a=new Int32Array(n);for(let o=0;o<n;++o)a[o]=r+o;return D(e)?function(t){e.uniform1iv(i,a),t.forEach(function(t,i){e.activeTexture(e.TEXTURE0+a[i]);let n,s;M(e,t)?(n=t,s=null):(n=t.texture,s=t.sampler),e.bindSampler(r,s),e.bindTexture(o,n)})}:function(t){e.uniform1iv(i,a),t.forEach(function(t,r){e.activeTexture(e.TEXTURE0+a[r]),e.bindTexture(o,t)})}}function F(e,t){return function(r){r.value?(e.disableVertexAttribArray(t),e.vertexAttrib4fv(t,r.value)):(e.bindBuffer(e.ARRAY_BUFFER,r.buffer),e.enableVertexAttribArray(t),e.vertexAttribPointer(t,r.num||r.size,r.type||e.FLOAT,r.normalize||!1,r.stride||0,r.offset||0),r.divisor!==void 0&&e.vertexAttribDivisor(t,r.divisor))}}function B(e,t){return function(r){r.value?(e.disableVertexAttribArray(t),e.vertexAttrib4iv(t,r.value)):(e.bindBuffer(e.ARRAY_BUFFER,r.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,r.num||r.size,r.type||e.INT,r.stride||0,r.offset||0),r.divisor!==void 0&&e.vertexAttribDivisor(t,r.divisor))}}function P(e,t){return function(r){r.value?(e.disableVertexAttribArray(t),e.vertexAttrib4uiv(t,r.value)):(e.bindBuffer(e.ARRAY_BUFFER,r.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,r.num||r.size,r.type||e.UNSIGNED_INT,r.stride||0,r.offset||0),r.divisor!==void 0&&e.vertexAttribDivisor(t,r.divisor))}}function V(e,t,r){const i=r.size,n=r.count;return function(r){e.bindBuffer(e.ARRAY_BUFFER,r.buffer);const o=r.size||r.num||i,a=r.type||e.FLOAT,s=He[a],u=s.size*o,_=r.normalize||!1,d=r.offset||0;for(let s=0;s<n;++s)e.enableVertexAttribArray(t+s),e.vertexAttribPointer(t+s,o/n,a,_,u,d+u/n*s),void 0!==r.divisor&&e.vertexAttribDivisor(t+s,r.divisor)}}function M(e,r){return qe||(qe=e.createTexture()),r instanceof qe.constructor}function D(e){return!!e.texStorage2D}function U(e){const t=e.name;return t.startsWith("gl_")||t.startsWith("webgl_")}function w(e,t){Je(e,0);const r=e.getExtension(t);if(r){const i={},n=Qe.exec(t)[1];for(const t in r){const o=r[t],a="function"==typeof o,s=a?n:"_"+n;let u=t;t.endsWith(s)&&(u=t.substring(0,t.length-s.length)),e[u]===void 0?a?e[u]=function(e){return function(){return e.apply(r,arguments)}}(o):(e[u]=o,i[u]=o):!a&&e[u]!==o&&console.warn(u,e[u],o,t)}i.constructor={name:r.constructor.name},Je(i,0)}return r}function G(e){for(let t=0;t<Ke.length;++t)w(e,Ke[t])}function X(e,...t){const r=k(t);return W(e,r)}function k(...e){const t=[];let r,i,n;if((e+"").replace(/[^\,\s]+/g,function(e){e&&t.push(e)}),t.forEach(e=>{if(n=document.getElementById(e),!n)throw"unknown script element "+e;0<=n.type.indexOf("vert")?r=n.text:0<=n.type.indexOf("frag")&&(i=n.text)}),!r)throw"VERTEX_SHADER String not exist";if(!i)throw"FRAGMENT_SHADER String not exist";return[r,i]}function W(e,...t){Array.isArray(t[0])&&(t=t[0]);const r=H(e,e.VERTEX_SHADER,t[0]),i=H(e,e.FRAGMENT_SHADER,t[1]);if(!r)throw"VERTEX_SHADER not exist";if(!i)throw"FRAGMENT_SHADER not exist";const n=e.createProgram();if(!n)throw"program not exist";e.attachShader(n,r),e.attachShader(n,i),e.linkProgram(n);const o=e.getProgramParameter(n,e.LINK_STATUS);if(!o){const t=e.getProgramInfoLog(n);throw e.deleteProgram(n),e.deleteShader(i),e.deleteShader(r),"Failed to link program: "+t.toString()}return n}function H(e,t,r){const i=e.createShader(t);if(!i)throw"unable to create shader";e.shaderSource(i,r),e.compileShader(i);const n=e.getShaderParameter(i,e.COMPILE_STATUS);if(!n){const t=e.getShaderInfoLog(i);throw e.deleteShader(i),"Failed to compile shader: "+t.toString()}return i}function Y(e,...t){Array.isArray(t[0])&&(t=t[0]);const r=0<t[0].indexOf("{")?W(e,t):X(e,t),i=q(e,r),n=j(e,r);return{program:r,uniformSetters:i,attribSetters:n}}function j(e,t){const r={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let o=0;o<n;++o){const i=e.getActiveAttrib(t,o);if(U(i))continue;const n=e.getAttribLocation(t,i.name),a=Ye[i.type],s=a.setter(e,n,a);s.location=n,r[i.name]=s}return r}function q(e,t){function r(t,r){const n=e.getUniformLocation(t,r.name),o=1<r.size&&"[0]"===r.name.substr(-3),a=r.type,s=He[a];if(!s)throw"unknown type: 0x"+a.toString(16);let u;if(s.bindPoint){const t=i;i+=r.size,u=o?s.arraySetter(e,a,t,n,r.size):s.setter(e,a,t,n,r.size)}else u=s.arraySetter&&o?s.arraySetter(e,n):s.setter(e,n);return u.location=n,u}let i=0;const n={},o=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let a=0;a<o;++a){const i=e.getActiveUniform(t,a);if(U(i))continue;let o=i.name;"[0]"===o.substr(-3)&&(o=o.substr(0,o.length-3));const s=r(t,i);n[o]=s}return n}function K(e,t){e=e.uniformSetters||e,Object.keys(t).forEach(function(r){const i=e[r];i&&i(t[r])})}function J(e,t,r){r.vertexArrayObject?e.bindVertexArray(r.vertexArrayObject):(Q(t.attribSetters||t,r.attribs),r.indices&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r.indices))}function Q(e,t){e=e.attribSetters||e,Object.keys(t).forEach(function(r){const i=e[r];i&&i(t[r])})}function Z(e,t){const r={attribs:$(e,t)};let i=t.indices;return i?(i=re(i,"indices"),r.indices=ee(e,i,e.ELEMENT_ARRAY_BUFFER),r.count=i.length,r.indexType=ne(i)):r.count=ue(t),r}function $(e,t){const r={};return Object.keys(t).forEach(function(i){if(!oe(i)){const n=t[i],o=n.name||n.attribName||je.attribPrefix(i),a=re(n,o);r[o]={buffer:ee(e,a,void 0,n.drawType),num:n.num||n.size||ie(o),type:ne(a),normalize:se(a),stride:n.stride||0,offset:n.offset||0,divisor:n.divisor,drawType:n.drawType||e.STATIC_DRAW}}}),e.bindBuffer(e.ARRAY_BUFFER,null),r}function ee(e,t,r,i){r=r||e.ARRAY_BUFFER;const n=e.createBuffer();return e.bindBuffer(r,n),e.bufferData(r,t,i||e.STATIC_DRAW),n}function te(e,t,r){const i=e.createVertexArray();return e.bindVertexArray(i),t.length||(t=[t]),t.forEach(function(t){J(e,t,r)}),e.bindVertexArray(null),{count:r.count,indexType:r.indexType,vertexArrayObject:i}}function re(e,t){if(ae(e))return e;if(ae(e.data))return e.data;Array.isArray(e)&&(e={data:e});let r=e.type;return r||(oe(t)?r=Uint16Array:r=Float32Array),new r(e.data)}function ie(e,t){let r;if(r=Ze.test(e)?2:$e.test(e)?4:3,0<t%r)throw"Can not guess num for attribute '"+e+"'. Tried "+r+" but "+t+" values is not evenly divisible by "+r+". You should specify it.";return r}function ne(e){if(e instanceof Int8Array)return be;if(e instanceof Uint8Array)return Ae;if(e instanceof Uint8ClampedArray)return Ae;if(e instanceof Int16Array)return ge;if(e instanceof Uint16Array)return Se;if(e instanceof Int32Array)return Re;if(e instanceof Uint32Array)return Ge;if(e instanceof Float32Array)return ze;throw"unsupported typed array type"}function oe(e){return"indices"===e}function ae(e){return e&&e.buffer&&e.buffer instanceof ArrayBuffer}function se(e){return!!(e instanceof Int8Array)||!!(e instanceof Uint8Array)}function ue(e){let t,r;for(r=0;r<et.length&&(t=et[r],!(t in e));++r);r===et.length&&(t=Object.keys(e)[0]);const n=e[t],o=_e(n).length,a=de(n,t);if(0<o%a)throw"numComponents "+a+" not correct for length "+o;return o/a}function _e(e){return e.length?e:e.data}function de(e,t){return e.num||e.size||ie(t,_e(e).length)}function fe(e,t,r,i,n){r=r||e.TRIANGLES,i=i||t.count,n=n||0;const o=t.indices,a=t.indexType;a||o?e.drawElements(r,i,a||Se,n):e.drawArrays(r,n,i)}let ve=Float32Array,Ee=Float32Array;const xe=e(),he=e(),ye=e(),be=5120,Ae=5121,ge=5122,Se=5123,ze=5126,Le=35664,Ne=35665,Ce=35666,Re=5124,Ie=35667,Oe=35668,Fe=35669,Be=35670,Pe=35671,Ve=35672,Me=35673,De=35674,Ue=35675,we=35676,Ge=5125,Xe=36294,ke=36295,We=36296,He={};He[ze]={Type:Float32Array,size:4,setter:function(e,t){return function(r){e.uniform1f(t,r)}},arraySetter:function(e,t){return function(r){e.uniform1fv(t,r)}}},He[Le]={Type:Float32Array,size:8,setter:function(e,t){return function(r){e.uniform2fv(t,r)}}},He[Ne]={Type:Float32Array,size:12,setter:function(e,t){return function(r){e.uniform3fv(t,r)}}},He[Ce]={Type:Float32Array,size:16,setter:function(e,t){return function(r){e.uniform4fv(t,r)}}},He[Re]={Type:Int32Array,size:4,setter:z,arraySetter:L},He[Ie]={Type:Int32Array,size:8,setter:N},He[Oe]={Type:Int32Array,size:12,setter:C},He[Fe]={Type:Int32Array,size:16,setter:R},He[Ge]={Type:Uint32Array,size:4,setter:function(e,t){return function(r){e.uniform1ui(t,r)}},arraySetter:function(e,t){return function(r){e.uniform1uiv(t,r)}}},He[Xe]={Type:Uint32Array,size:8,setter:function(e,t){return function(r){e.uniform2uiv(t,r)}}},He[ke]={Type:Uint32Array,size:12,setter:function(e,t){return function(r){e.uniform3uiv(t,r)}}},He[We]={Type:Uint32Array,size:16,setter:function(e,t){return function(r){e.uniform4uiv(t,r)}}},He[Be]={Type:Uint32Array,size:4,setter:z,arraySetter:L},He[Pe]={Type:Uint32Array,size:8,setter:N},He[Ve]={Type:Uint32Array,size:12,setter:C},He[Me]={Type:Uint32Array,size:16,setter:R},He[De]={Type:Float32Array,size:16,setter:function(e,t){return function(r){e.uniformMatrix2fv(t,!1,r)}}},He[Ue]={Type:Float32Array,size:36,setter:function(e,t){return function(r){e.uniformMatrix3fv(t,!1,r)}}},He[we]={Type:Float32Array,size:64,setter:function(e,t){return function(r){e.uniformMatrix4fv(t,!1,r)}}},He[35685]={Type:Float32Array,size:24,setter:function(e,t){return function(r){e.uniformMatrix2x3fv(t,!1,r)}}},He[35686]={Type:Float32Array,size:32,setter:function(e,t){return function(r){e.uniformMatrix2x4fv(t,!1,r)}}},He[35687]={Type:Float32Array,size:24,setter:function(e,t){return function(r){e.uniformMatrix3x2fv(t,!1,r)}}},He[35688]={Type:Float32Array,size:48,setter:function(e,t){return function(r){e.uniformMatrix3x4fv(t,!1,r)}}},He[35689]={Type:Float32Array,size:32,setter:function(e,t){return function(r){e.uniformMatrix4x2fv(t,!1,r)}}},He[35690]={Type:Float32Array,size:48,setter:function(e,t){return function(r){e.uniformMatrix4x3fv(t,!1,r)}}},He[35678]={Type:null,size:0,setter:I,arraySetter:O,bindPoint:3553},He[35680]={Type:null,size:0,setter:I,arraySetter:O,bindPoint:34067},He[35679]={Type:null,size:0,setter:I,arraySetter:O,bindPoint:32879},He[36289]={Type:null,size:0,setter:I,arraySetter:O,bindPoint:35866};const Ye={};Ye[ze]={size:4,setter:F},Ye[Le]={size:8,setter:F},Ye[Ne]={size:12,setter:F},Ye[Ce]={size:16,setter:F},Ye[Re]={size:4,setter:B},Ye[Ie]={size:8,setter:B},Ye[Oe]={size:12,setter:B},Ye[Fe]={size:16,setter:B},Ye[Ge]={size:4,setter:P},Ye[Xe]={size:8,setter:P},Ye[ke]={size:12,setter:P},Ye[We]={size:16,setter:P},Ye[Be]={size:4,setter:B},Ye[Pe]={size:8,setter:B},Ye[Ve]={size:12,setter:B},Ye[Me]={size:16,setter:B},Ye[De]={size:4,setter:V,count:2},Ye[Ue]={size:9,setter:V,count:3},Ye[we]={size:16,setter:V,count:4};const je={addExtensionsToContext:!0,attribPrefix:e=>"a"+e[0].toUpperCase()+e.substr(1)};let qe;const Ke=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_color_buffer_float","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2","EXT_frag_depth","EXT_sRGB","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_depth_texture","WEBGL_draw_buffers"],Je=function(){function e(e){const i=e.constructor.name;if(!t[i]){for(const t in e)if("number"==typeof e[t]){const i=r[e[t]];r[e[t]]=i?`${i} | ${t}`:t}t[i]=!0}}const t={},r={};return function(t,i){return e(t),r[i]||"0x"+i.toString(16)}}(),Qe=/^(.*?)_/,Ze=/coord|texture/i,$e=/color|colour/i,et=["position","positions","a_position"];const tt=document.getElementById("canvas"),rt=function(e,t){const r=["webgl","experimental-webgl"];let n=null;for(let o=0,i=r.length;o<i;o++)if(n=e.getContext(r[o],t),n){je.addExtensionsToContext&&G(n);break}return n}(tt),y=[];(function(){if(!rt)return void console.log("Failed to get the rendering context for WebGL");const e=Y(rt,"#define GLSLIFY 1\nattribute vec4 aPosition;\nattribute vec4 aNormal;\nattribute vec2 aTexcoord;\nuniform mat4 u_vpMatrix;\nuniform mat4 u_modelMatrix;\nvarying vec3 v_normal;\nvarying vec3 v_position;\nvarying vec2 v_texcoord;\n\nvoid main() {\n  gl_Position = u_vpMatrix * u_modelMatrix * aPosition;\n  v_normal = vec3(u_modelMatrix * aNormal);\n  v_position= vec3(u_modelMatrix * aPosition);\n  v_texcoord = aTexcoord;\n}","precision mediump float;\n#define GLSLIFY 1\nuniform vec3 u_viewPosition;\nuniform vec3 u_lightPosition;\nuniform vec3 u_lightColor;\nuniform vec3 u_ambientColor;\nuniform vec3 u_specularColor;\nuniform float u_shininess;\nuniform vec4 u_color;\nvarying vec3 v_normal;\nvarying vec3 v_position;\n\nvoid main() {\n    vec3 normal = normalize(v_normal);\n    // \u73AF\u5883\u5149\n    vec3 ambient = u_ambientColor * u_color.rgb;\n    // \u5149\u7EBF\u65B9\u5411\n    vec3 lightDirection = normalize(u_lightPosition - v_position);\n    // \u5149\u7EBF\u65B9\u5411\u548C\u6CD5\u5411\u91CF\u5939\u89D2\n    float cosTheta = max(dot(lightDirection, normal), 0.0);\n    vec3 diffuse = u_lightColor * u_color.rgb * cosTheta;\n    \n    vec3 viewDirection = normalize(u_viewPosition - v_position);\n    vec3 halfwayDir = normalize(lightDirection + viewDirection);\n    float specularIntensity = pow(max(dot(normal, halfwayDir), 0.0), u_shininess);\n    vec3 specular = u_specularColor.rgb * specularIntensity;\n\n    gl_FragColor = vec4(ambient + diffuse + specular, u_color.a);\n}"),t=te(rt,e,Z(rt,T(20))),r=[te(rt,e,Z(rt,v(1))),te(rt,e,Z(rt,h(1,50))),te(rt,e,Z(rt,x(1,3,40))),te(rt,e,Z(rt,E(1,2,30)))];for(var A=0;8>A;A++){let e=m(l(c()));3<A&&(e[3]=(A-3)/10),y.push({x:9*le(2*(Math.random()*pe)),y:5*me(Math.random()*pe/2)+1,z:5*le(2*(Math.random()*pe)),color:e})}rt.clearColor(.1,.1,.1,1),rt.enable(rt.DEPTH_TEST),rt.enable(rt.CULL_FACE),p(tt),rt.viewport(0,0,tt.width,tt.height),rt.useProgram(e.program);const S=[0,9,15],z=n(),L=s(pe/3,tt.width/tt.height,.5,100);const N=n();K(e,{u_lightPosition:[0,9,-15],u_lightColor:[1,1,1],u_ambientColor:[.8,.8,.8],u_specularColor:[1,1,1],u_shininess:20}),function i(){const s=f(d(N,pe/180,N),S),c=o(u(s,[0,0,0],[0,1,0]));a(L,c,z),rt.clear(rt.COLOR_BUFFER_BIT|rt.DEPTH_BUFFER_BIT),J(rt,e,t),K(e,{u_modelMatrix:n(),u_viewPosition:s,u_vpMatrix:z,u_specularColor:[.3,.3,.3],u_color:[.25,.25,.2,1]}),fe(rt,t);let l;y.forEach((t,n)=>{l=r[n%r.length],J(rt,e,l),K(e,{u_modelMatrix:_([t.x,t.y,t.z]),u_viewPosition:s,u_vpMatrix:z,u_color:t.color}),4>n?(rt.depthMask(!0),rt.disable(rt.BLEND)):(rt.depthMask(!1),rt.enable(rt.BLEND),rt.blendFunc(rt.SRC_ALPHA,rt.ONE_MINUS_SRC_ALPHA)),fe(rt,l)}),rt.bindVertexArray(null),requestAnimationFrame(i)}()})()})();</script></body></html>