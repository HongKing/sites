<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<title>3D圆球</title>
<link rel="stylesheet" href="../../css/pure-min.css">
<link rel="stylesheet" href="../../css/fontello.css">
<link rel="stylesheet" href="../css/style.css">


<!--[if lt IE 9]>
<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
</head>
<body>
	<div class="content">
		<a class="github" href="https://github.com/edwardzhong">
			<img src="../img/github.png" alt="">
		</a>
		<header class="header">
			<h1><a href="../index.html">Jeff Zhong's Demo</a></h1>
		</header>
		<div class="main grid">
		<a class="effect-list" href="../index.html">&larr;&nbsp;effect list</a>
		
<h2>3D圆球</h2>
<canvas id="canvas" width="800" height="600"></canvas>
 </div>
		<footer class="footer">
			<p>Copyright &copy; 2017 <a href="https://github.com/edwardzhong">Jeff Zhong</a></p>
		</footer>
	</div>

<script src="../../js/canvas.min.js"></script>
<script src="../../js/ball3d.js"></script>
<script>
    var canvas=document.getElementById('canvas'),
        ctx=canvas.getContext('2d'),
        Nums=150,
        mouse=CaptureMouse(canvas),
        Z=400,
        R=200,
        Balls=[],
        W=canvas.width,
        H=canvas.height;

    ctx.fillStyle='hsla(0,100%,5%,1)'
    ctx.translate(W/2,H/2); 

    for(var i=0;i<Nums;i++){
        var k = -1+(2*(i+1)-1)/Nums;
        var a = Math.acos(k);
        var b = a*Math.sqrt(Nums*Math.PI);
        // var a = Math.random()*2*Math.PI;
        // var b = Math.random()*2*Math.PI;
        var ball=new Ball3d(5,RandomColor());
        ball.xpos = R * Math.sin(a) * Math.cos(b);
        ball.ypos = R * Math.sin(a) * Math.sin(b); 
        ball.zpos = R * Math.cos(a);
        Balls.push(ball);
    }
    function update(b,i){
        var angleX=(mouse.y-H/2)*0.0001;
        var angleY=(mouse.x-W/2)*0.0001;

        var posX=Rotates.rotateX({y:b.ypos,z:b.zpos},angleX);
        b.ypos=posX.y;
        b.zpos=posX.z;
        var posY=Rotates.rotateY({x:b.xpos,z:b.zpos},angleY);
        b.xpos=posY.x;
        b.zpos=posY.z;
        var scale=Z/(b.zpos+Z);
        b.scaleX=b.scaleY=scale;
        b.x=b.xpos*scale;
        b.y=b.ypos*scale;
    }

    function draw(b,i){
        b.draw(ctx);
    }

    (function animate(){
        ctx.fillRect(-W/2,-H/2,W,H);
        Balls.forEach(update);
        Balls.sort((a,b)=>b.zpos-a.zpos);
        ctx.save();
        // ctx.globalCompositeOperation='lighter';
        Balls.forEach(draw);
        ctx.restore();
        requestAnimationFrame(animate);
    }());
</script>

</body>
</html>