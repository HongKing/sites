(function(){'use strict';var be=Math.floor,ge=Math.sin,Ae=Math.cos,Se=Math.PI,ze=Math.sqrt;function e(e,t,i){const r=new Le(3);return e&&(r[0]=e),t&&(r[1]=t),i&&(r[2]=i),r}function t(e,t,i){return i=i||new Le(3),i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i}function i(e,t,i){return i=i||new Le(3),i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i}function r(e,t,i){i=i||new Le(3);const r=e[2]*t[0]-e[0]*t[2],n=e[0]*t[1]-e[1]*t[0];return i[0]=e[1]*t[2]-e[2]*t[1],i[1]=r,i[2]=n,i}function n(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function o(e){return ze(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}function s(e,t){t=t||new Le(3);const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=ze(i);return 1e-5<r?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=0,t[1]=0,t[2]=0),t}function a(e,t){return t=t||new Le(3),t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function u(e){return e=e||new Re(16),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function l(e,t){t=t||new Re(16);const i=e[0],r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],u=e[6],l=e[7],c=e[8],_=e[9],m=e[10],f=e[11],p=e[12],h=e[13],v=e[14],T=e[15],x=m*T,E=v*f,y=u*T,A=v*l,S=u*f,z=m*l,L=n*T,R=v*o,C=n*f,N=m*o,I=n*l,O=u*o,F=c*h,B=p*_,V=s*h,P=p*a,D=s*_,w=c*a,M=i*h,U=p*r,G=i*_,k=c*r,X=i*a,W=s*r,Y=x*a+A*_+S*h-(E*a+y*_+z*h),H=E*r+L*_+N*h-(x*r+R*_+C*h),j=y*r+R*a+I*h-(A*r+L*a+O*h),q=z*r+C*a+O*_-(S*r+N*a+I*_),K=1/(i*Y+s*H+c*j+p*q);return t[0]=K*Y,t[1]=K*H,t[2]=K*j,t[3]=K*q,t[4]=K*(E*s+y*c+z*p-(x*s+A*c+S*p)),t[5]=K*(x*i+R*c+C*p-(E*i+L*c+N*p)),t[6]=K*(A*i+L*s+O*p-(y*i+R*s+I*p)),t[7]=K*(S*i+N*s+I*c-(z*i+C*s+O*c)),t[8]=K*(F*l+P*f+D*T-(B*l+V*f+w*T)),t[9]=K*(B*o+M*f+k*T-(F*o+U*f+G*T)),t[10]=K*(V*o+U*l+X*T-(P*o+M*l+W*T)),t[11]=K*(w*o+G*l+W*f-(D*o+k*l+X*f)),t[12]=K*(V*m+w*v+B*u-(D*v+F*u+P*m)),t[13]=K*(G*v+F*n+U*m-(M*m+k*v+B*n)),t[14]=K*(M*u+W*v+P*n-(X*v+V*n+U*u)),t[15]=K*(X*m+D*n+k*u-(G*u+W*m+w*n)),t}function d(e,t,i){i=i||new Re(16);const r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],u=e[5],l=e[6],d=e[7],c=e[8],_=e[9],m=e[10],f=e[11],p=e[12],h=e[13],v=e[14],T=e[15],x=t[0],E=t[1],y=t[2],A=t[3],S=t[4],z=t[5],L=t[6],R=t[7],C=t[8],N=t[9],I=t[10],O=t[11],F=t[12],B=t[13],V=t[14],P=t[15];return i[0]=r*x+a*E+c*y+p*A,i[1]=n*x+u*E+_*y+h*A,i[2]=o*x+l*E+m*y+v*A,i[3]=s*x+d*E+f*y+T*A,i[4]=r*S+a*z+c*L+p*R,i[5]=n*S+u*z+_*L+h*R,i[6]=o*S+l*z+m*L+v*R,i[7]=s*S+d*z+f*L+T*R,i[8]=r*C+a*N+c*I+p*O,i[9]=n*C+u*N+_*I+h*O,i[10]=o*C+l*N+m*I+v*O,i[11]=s*C+d*N+f*I+T*O,i[12]=r*F+a*B+c*V+p*P,i[13]=n*F+u*B+_*V+h*P,i[14]=o*F+l*B+m*V+v*P,i[15]=s*F+d*B+f*V+T*P,i}function c(e,t,i,r,n){var o=Math.tan;n=n||new Re(16);const s=o(.5*Se-.5*e),a=1/(i-r);return n[0]=s/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=s,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=(i+r)*a,n[11]=-1,n[12]=0,n[13]=0,n[14]=2*(i*r*a),n[15]=0,n}function _(e,i,n,o){o=o||new Re(16);const a=Ce,u=Ne,l=Ie;return s(t(e,i,l),l),s(r(n,l,a),a),s(r(l,a,u),u),o[0]=a[0],o[1]=a[1],o[2]=a[2],o[3]=0,o[4]=u[0],o[5]=u[1],o[6]=u[2],o[7]=0,o[8]=l[0],o[9]=l[1],o[10]=l[2],o[11]=0,o[12]=e[0],o[13]=e[1],o[14]=e[2],o[15]=1,o}function m(e,t){return t=t||new Re(16),t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function f(e,t,i){i=i||new Re(16);const r=t[0],n=t[1],o=t[2],s=e[0],a=e[1],u=e[2],l=e[3],d=e[4],c=e[5],_=e[6],m=e[7],f=e[8],p=e[9],h=e[10],v=e[11],T=e[12],x=e[13],E=e[14],y=e[15];return e!==i&&(i[0]=s,i[1]=a,i[2]=u,i[3]=l,i[4]=d,i[5]=c,i[6]=_,i[7]=m,i[8]=f,i[9]=p,i[10]=h,i[11]=v),i[12]=s*r+d*n+f*o+T,i[13]=a*r+c*n+p*o+x,i[14]=u*r+_*n+h*o+E,i[15]=l*r+m*n+v*o+y,i}function p(e,t){t=t||new Re(16);const i=Ae(e),r=ge(e);return t[0]=i,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function h(e,t,i,r){r=r||new Re(16);let o=t[0],a=t[1],u=t[2];const l=ze(o*o+a*a+u*u);o/=l,a/=l,u/=l;const n=o*o,d=a*a,_=u*u,m=Ae(i),c=ge(i),s=1-m,f=n+(1-n)*m,p=o*a*s+u*c,h=o*u*s-a*c,v=o*a*s-u*c,T=d+(1-d)*m,E=a*u*s+o*c,A=o*u*s+a*c,S=a*u*s-o*c,L=_+(1-_)*m,R=e[0],C=e[1],N=e[2],I=e[3],O=e[4],F=e[5],B=e[6],V=e[7],P=e[8],D=e[9],w=e[10],M=e[11];return r[0]=f*R+p*O+h*P,r[1]=f*C+p*F+h*D,r[2]=f*N+p*B+h*w,r[3]=f*I+p*V+h*M,r[4]=v*R+T*O+E*P,r[5]=v*C+T*F+E*D,r[6]=v*N+T*B+E*w,r[7]=v*I+T*V+E*M,r[8]=A*R+S*O+L*P,r[9]=A*C+S*F+L*D,r[10]=A*N+S*B+L*w,r[11]=A*I+S*V+L*M,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r}function x(t,i,r){r=r||e();const n=i[0],o=i[1],s=i[2],a=n*t[3]+o*t[7]+s*t[11]+t[15];return r[0]=(n*t[0]+o*t[4]+s*t[8]+t[12])/a,r[1]=(n*t[1]+o*t[5]+s*t[9]+t[13])/a,r[2]=(n*t[2]+o*t[6]+s*t[10]+t[14])/a,r}function E(t,i,r){r=r||e();const n=i[0],o=i[1],s=i[2];return r[0]=n*t[0]+o*t[4]+s*t[8],r[1]=n*t[1]+o*t[5]+s*t[9],r[2]=n*t[2]+o*t[6]+s*t[10],r}function y(){var e=be(360*Math.random()),t=be(50*Math.random()+50),i=be(20*Math.random()+40);return[e,t,i]}function A(e){var n=Math.ceil,o=parseFloat(e[0]/360,10),s=parseFloat(e[1]/100,10),a=parseFloat(e[2]/100,10);if(0==s){var u=g=b=n(255*a);return[u,g,b]}for(var r,l=.5<=a?a+s-a*s:a*(1+s),d=2*a-l,c=[1/3,0,-1/3],_=0;3>_;_++)r=o+c[_],0>r&&(r+=1),1<r&&(r-=1),r=1>6*r?d+6*(l-d)*r:1>2*r?l:2>3*r?d+6*((l-d)*(2/3-r)):d,c[_]=n(255*r);return c}function S(e){return[e[0]/255,e[1]/255,e[2]/255,e[3]||1]}function z(e,t,i){if(!e)throw new Error("canvas not exist");var r=e.getBoundingClientRect();return{x:(t-r.left)*(e.width/r.width),y:(i-r.top)*(e.height/r.height)}}function L(e,t,i){if(!e)throw new Error("canvas not exist");var r=e.getBoundingClientRect(),n=e.width,o=e.height,s=(t-r.left)*(n/r.width),a=(i-r.top)*(o/r.height);return{x:(s-n/2)/(n/2),y:(o/2-a)/(o/2)}}function R(e,t){t=t||window.devicePixelRatio;var i=e.width,r=e.height,n=be(e.clientWidth*t),o=be(e.clientHeight*t);(i!==n||r!==o)&&(e.width=n,e.height=o,e.style.width=i+"px",e.style.height=r+"px")}function C(e,t){var i="mousewheel";try{document.createEvent("MouseScrollEvents"),i="DOMMouseScroll"}catch(t){}e.addEventListener(i,function(i){if("wheelDelta"in i){var e=i.wheelDelta;window.opera&&10>opera.version()&&(e=-e),i.delta=Math.round(e)/120}else"detail"in i&&(i.wheelDelta=40*-i.detail,i.delta=i.wheelDelta/120);t(i)},!1)}function N(t,r,u,l,d){function c(i){var e=Math.acos,r=z(t,i.clientX,i.clientY),o=2*((A.y>T.y?A.x-r.x:r.x-A.x)/f*Se),u=(A.y-r.y)/v*Se,l=R[1],d=e(n(s(R),s([0,l,0]))),c=p(o);d+u<Se/90&&0<l&&0>u&&(u=Se/180-d),d-u<Se/90&&0>l&&0<u&&(u=d-Se/180);var _=E(p(-Se/2),[R[0],0,R[2]]),m=h(c,_,-u);L=a(x(m,R))}function _(){R=a(L),t.removeEventListener("mouseup",_,!1),t.removeEventListener("mousemove",c,!1),t.removeEventListener("mouseout",_,!1)}if(!t)throw new Error("canvas not exist");d=d||[0,0,0],r=r||[0,5,5],u=u||1,l=l||50;var m,f=t.clientWidth,v=t.clientHeight,T={x:f/2,y:v/2},A=T,S=1,L=r,R=r;return C(t,function(t){var e=o(R);e<u+1&&0>t.delta||e>l-1&&0<t.delta||(S+=.05*t.delta,L=i(R,S),clearTimeout(m),m=setTimeout(function(){S=1,R=a(L)},20))}),t.addEventListener("mousedown",function(i){A=z(t,i.clientX,i.clientY),t.addEventListener("mousemove",c,!1),t.addEventListener("mouseup",_,!1),t.addEventListener("mouseout",_,!1)},!1),function(){return L}}function I(e,i,o){const s=[];if(i.forEach(a=>{if(a.pos){a.select=!1;const c=f(o,a.pos),_=a.attributes.position.length;let u,l,m,p,h,v;for(let e=0;e<_;e+=3){const t=x(c,a.attributes.position.slice(e,e+3));if(0==e){u=t[0],m=t[0],l=t[1],p=t[1],h=t[2],v=t[2];continue}t[0]>u&&(u=t[0]),t[0]<m&&(m=t[0]),t[1]>l&&(l=t[1]),t[1]<p&&(p=t[1]),t[2]>h&&(h=t[2]),t[2]<v&&(v=t[2])}if(e.x>=m&&e.x<=u&&e.y>=p&&e.y<=l){a.coord=[(u+m)/2,(l+p)/2,(h+v)/2];const o=[e.x,e.y,0],f=[0,0,1];for(let e=0;e<_;e+=9){const i=x(c,a.attributes.position.slice(e,e+3)),l=x(c,a.attributes.position.slice(e+3,e+6)),d=x(c,a.attributes.position.slice(e+6,e+9)),_=t(o,i),m=t(l,i),p=t(d,i),h=r(f,p),T=n(h,m);if(0==T)continue;const E=r(_,m),y=n(h,_)/T,u=n(E,f)/T;if(0<=y&&0<=u&&1>=y+u){s.push(a);break}}}}}),!!s.length){const e=1==s.length?s[0]:s.sort((e,t)=>e.coord[2]-t.coord[2])[0];return e.select=!0,e}}function O(e){return{position:[-e,0,-e,-e,0,e,e,0,-e,e,0,-e,-e,0,e,e,0,e,e,0,-e,-e,0,e,-e,0,-e,e,0,e,-e,0,e,e,0,-e],normal:[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],texcoord:[0,1,0,0,1,1,1,1,0,0,1,0,1,1,0,0,0,1,1,0,0,0,1,1]}}function F(t){var i=t[0],r=t[1],n=t[2],e=ze(i*i+r*r+n*n);return e?1==e?t:(e=1/e,t[0]=i*e,t[1]=r*e,t[2]=n*e,t):(t[0]=0,t[1]=0,t[2]=0,t)}function B(e){return tt[e].bindPoint}function V(e,t){return function(i){e.uniform1i(t,i)}}function P(e,t){return function(i){e.uniform1iv(t,i)}}function D(e,t){return function(i){e.uniform2iv(t,i)}}function w(e,t){return function(i){e.uniform3iv(t,i)}}function M(e,t){return function(i){e.uniform4iv(t,i)}}function U(e,t,i,r){const n=B(t);return j(e)?function(t){let o,s;H(e,t)?(o=t,s=null):(o=t.texture,s=t.sampler),e.uniform1i(r,i),e.activeTexture(e.TEXTURE0+i),e.bindTexture(n,o),e.bindSampler(i,s)}:function(t){e.uniform1i(r,i),e.activeTexture(e.TEXTURE0+i),e.bindTexture(n,t)}}function G(e,t,r,n,o){const s=B(t),a=new Int32Array(o);for(let s=0;s<o;++s)a[s]=r+s;return j(e)?function(t){e.uniform1iv(n,a),t.forEach(function(t,i){e.activeTexture(e.TEXTURE0+a[i]);let n,o;H(e,t)?(n=t,o=null):(n=t.texture,o=t.sampler),e.bindSampler(r,o),e.bindTexture(s,n)})}:function(t){e.uniform1iv(n,a),t.forEach(function(t,i){e.activeTexture(e.TEXTURE0+a[i]),e.bindTexture(s,t)})}}function k(e,t){return function(i){i.value?(e.disableVertexAttribArray(t),e.vertexAttrib4fv(t,i.value)):(e.bindBuffer(e.ARRAY_BUFFER,i.buffer),e.enableVertexAttribArray(t),e.vertexAttribPointer(t,i.num||i.size,i.type||e.FLOAT,i.normalize||!1,i.stride||0,i.offset||0),i.divisor!==void 0&&e.vertexAttribDivisor(t,i.divisor))}}function X(e,t){return function(i){i.value?(e.disableVertexAttribArray(t),e.vertexAttrib4iv(t,i.value)):(e.bindBuffer(e.ARRAY_BUFFER,i.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,i.num||i.size,i.type||e.INT,i.stride||0,i.offset||0),i.divisor!==void 0&&e.vertexAttribDivisor(t,i.divisor))}}function W(e,t){return function(i){i.value?(e.disableVertexAttribArray(t),e.vertexAttrib4uiv(t,i.value)):(e.bindBuffer(e.ARRAY_BUFFER,i.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,i.num||i.size,i.type||e.UNSIGNED_INT,i.stride||0,i.offset||0),i.divisor!==void 0&&e.vertexAttribDivisor(t,i.divisor))}}function Y(e,t,i){const r=i.size,n=i.count;return function(o){e.bindBuffer(e.ARRAY_BUFFER,o.buffer);const s=o.size||o.num||r,a=o.type||e.FLOAT,u=tt[a],l=u.size*s,d=o.normalize||!1,c=o.offset||0;for(let r=0;r<n;++r)e.enableVertexAttribArray(t+r),e.vertexAttribPointer(t+r,s/n,a,d,l,c+l/n*r),void 0!==o.divisor&&e.vertexAttribDivisor(t+r,o.divisor)}}function H(e,i){return nt||(nt=e.createTexture()),i instanceof nt.constructor}function j(e){return!!e.texStorage2D}function q(e){const t=e.name;return t.startsWith("gl_")||t.startsWith("webgl_")}function K(e,t){st(e,0);const i=e.getExtension(t);if(i){const r={},n=at.exec(t)[1];for(const t in i){const o=i[t],s="function"==typeof o,a=s?n:"_"+n;let u=t;t.endsWith(a)&&(u=t.substring(0,t.length-a.length)),e[u]===void 0?s?e[u]=function(e){return function(){return e.apply(i,arguments)}}(o):(e[u]=o,r[u]=o):!s&&e[u]!==o&&console.warn(u,e[u],o,t)}r.constructor={name:i.constructor.name},st(r,0)}return i}function J(e){for(let t=0;t<ot.length;++t)K(e,ot[t])}function Q(e,...t){const i=Z(t);return $(e,i)}function Z(...e){const t=[];let i,r,n;if((e+"").replace(/[^\,\s]+/g,function(e){e&&t.push(e)}),t.forEach(e=>{if(n=document.getElementById(e),!n)throw"unknown script element "+e;0<=n.type.indexOf("vert")?i=n.text:0<=n.type.indexOf("frag")&&(r=n.text)}),!i)throw"VERTEX_SHADER String not exist";if(!r)throw"FRAGMENT_SHADER String not exist";return[i,r]}function $(e,...t){Array.isArray(t[0])&&(t=t[0]);const i=ee(e,e.VERTEX_SHADER,t[0]),r=ee(e,e.FRAGMENT_SHADER,t[1]);if(!i)throw"VERTEX_SHADER not exist";if(!r)throw"FRAGMENT_SHADER not exist";const n=e.createProgram();if(!n)throw"program not exist";e.attachShader(n,i),e.attachShader(n,r),e.linkProgram(n);const o=e.getProgramParameter(n,e.LINK_STATUS);if(!o){const t=e.getProgramInfoLog(n);throw e.deleteProgram(n),e.deleteShader(r),e.deleteShader(i),"Failed to link program: "+t.toString()}return n}function ee(e,t,i){const r=e.createShader(t);if(!r)throw"unable to create shader";e.shaderSource(r,i),e.compileShader(r);const n=e.getShaderParameter(r,e.COMPILE_STATUS);if(!n){const t=e.getShaderInfoLog(r);throw e.deleteShader(r),"Failed to compile shader: "+t.toString()}return r}function te(e,...t){Array.isArray(t[0])&&(t=t[0]);const i=0<t[0].indexOf("{")?$(e,t):Q(e,t),r=re(e,i),n=ie(e,i);return{program:i,uniformSetters:r,attribSetters:n}}function ie(e,t){const r={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let o=0;o<n;++o){const i=e.getActiveAttrib(t,o);if(q(i))continue;const n=e.getAttribLocation(t,i.name),s=it[i.type],a=s.setter(e,n,s);a.location=n,r[i.name]=a}return r}function re(e,t){function r(t,i){const r=e.getUniformLocation(t,i.name),o=1<i.size&&"[0]"===i.name.substr(-3),s=i.type,a=tt[s];if(!a)throw"unknown type: 0x"+s.toString(16);let u;if(a.bindPoint){const t=n;n+=i.size,u=o?a.arraySetter(e,s,t,r,i.size):a.setter(e,s,t,r,i.size)}else u=a.arraySetter&&o?a.arraySetter(e,r):a.setter(e,r);return u.location=r,u}let n=0;const o={},s=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let n=0;n<s;++n){const i=e.getActiveUniform(t,n);if(q(i))continue;let s=i.name;"[0]"===s.substr(-3)&&(s=s.substr(0,s.length-3));const a=r(t,i);o[s]=a}return o}function ne(e,t){e=e.uniformSetters||e,Object.keys(t).forEach(function(i){const r=e[i];r&&r(t[i])})}function oe(e,t,i){i.vertexArrayObject?e.bindVertexArray(i.vertexArrayObject):(se(t.attribSetters||t,i.attribs),i.indices&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i.indices))}function se(e,t){e=e.attribSetters||e,Object.keys(t).forEach(function(i){const r=e[i];r&&r(t[i])})}function ae(e,t){const i={attribs:ue(e,t)};let r=t.indices;return r?(r=ce(r,"indices"),i.indices=le(e,r,e.ELEMENT_ARRAY_BUFFER),i.count=r.length,i.indexType=me(r)):i.count=ve(t),i}function ue(e,t){const i={};return Object.keys(t).forEach(function(r){if(!fe(r)){const n=t[r],o=n.name||n.attribName||rt.attribPrefix(r),s=ce(n,o);i[o]={buffer:le(e,s,void 0,n.drawType),num:n.num||n.size||_e(o),type:me(s),normalize:he(s),stride:n.stride||0,offset:n.offset||0,divisor:n.divisor,drawType:n.drawType||e.STATIC_DRAW}}}),e.bindBuffer(e.ARRAY_BUFFER,null),i}function le(e,t,i,r){i=i||e.ARRAY_BUFFER;const n=e.createBuffer();return e.bindBuffer(i,n),e.bufferData(i,t,r||e.STATIC_DRAW),n}function de(e,t,i){const r=e.createVertexArray();return e.bindVertexArray(r),t.length||(t=[t]),t.forEach(function(t){oe(e,t,i)}),e.bindVertexArray(null),{count:i.count,indexType:i.indexType,vertexArrayObject:r}}function ce(e,t){if(pe(e))return e;if(pe(e.data))return e.data;Array.isArray(e)&&(e={data:e});let i=e.type;return i||(fe(t)?i=Uint16Array:i=Float32Array),new i(e.data)}function _e(e,t){let i;if(i=ut.test(e)?2:lt.test(e)?4:3,0<t%i)throw"Can not guess num for attribute '"+e+"'. Tried "+i+" but "+t+" values is not evenly divisible by "+i+". You should specify it.";return i}function me(e){if(e instanceof Int8Array)return Oe;if(e instanceof Uint8Array)return Fe;if(e instanceof Uint8ClampedArray)return Fe;if(e instanceof Int16Array)return Be;if(e instanceof Uint16Array)return Ve;if(e instanceof Int32Array)return Ue;if(e instanceof Uint32Array)return Qe;if(e instanceof Float32Array)return Pe;throw"unsupported typed array type"}function fe(e){return"indices"===e}function pe(e){return e&&e.buffer&&e.buffer instanceof ArrayBuffer}function he(e){return!!(e instanceof Int8Array)||!!(e instanceof Uint8Array)}function ve(e){let t,r;for(r=0;r<dt.length&&(t=dt[r],!(t in e));++r);r===dt.length&&(t=Object.keys(e)[0]);const n=e[t],o=Te(n).length,s=xe(n,t);if(0<o%s)throw"numComponents "+s+" not correct for length "+o;return o/s}function Te(e){return e.length?e:e.data}function xe(e,t){return e.num||e.size||_e(t,Te(e).length)}function Ee(e,t,i,r,n){i=i||e.TRIANGLES,r=r||t.count,n=n||0;const o=t.indices,s=t.indexType;s||o?e.drawElements(i,r,s||Ve,n):e.drawArrays(i,n,r)}function ye(e){const t=pt.measureText(e.name).width;pt.save(),pt.fillStyle="hsla(0,0%,30%,1)",pt.fillRect(e.x-50,e.y-30,t+20,50),pt.restore(),pt.strokeRect(e.x-50,e.y-30,t+20,50),pt.fillText(e.name,e.x-40,e.y),pt.strokeText(e.name,e.x-40,e.y)}let Le=Float32Array,Re=Float32Array;const Ce=e(),Ne=e(),Ie=e(),Oe=5120,Fe=5121,Be=5122,Ve=5123,Pe=5126,De=35664,we=35665,Me=35666,Ue=5124,Ge=35667,ke=35668,Xe=35669,We=35670,Ye=35671,He=35672,je=35673,qe=35674,Ke=35675,Je=35676,Qe=5125,Ze=36294,$e=36295,et=36296,tt={};tt[Pe]={Type:Float32Array,size:4,setter:function(e,t){return function(i){e.uniform1f(t,i)}},arraySetter:function(e,t){return function(i){e.uniform1fv(t,i)}}},tt[De]={Type:Float32Array,size:8,setter:function(e,t){return function(i){e.uniform2fv(t,i)}}},tt[we]={Type:Float32Array,size:12,setter:function(e,t){return function(i){e.uniform3fv(t,i)}}},tt[Me]={Type:Float32Array,size:16,setter:function(e,t){return function(i){e.uniform4fv(t,i)}}},tt[Ue]={Type:Int32Array,size:4,setter:V,arraySetter:P},tt[Ge]={Type:Int32Array,size:8,setter:D},tt[ke]={Type:Int32Array,size:12,setter:w},tt[Xe]={Type:Int32Array,size:16,setter:M},tt[Qe]={Type:Uint32Array,size:4,setter:function(e,t){return function(i){e.uniform1ui(t,i)}},arraySetter:function(e,t){return function(i){e.uniform1uiv(t,i)}}},tt[Ze]={Type:Uint32Array,size:8,setter:function(e,t){return function(i){e.uniform2uiv(t,i)}}},tt[$e]={Type:Uint32Array,size:12,setter:function(e,t){return function(i){e.uniform3uiv(t,i)}}},tt[et]={Type:Uint32Array,size:16,setter:function(e,t){return function(i){e.uniform4uiv(t,i)}}},tt[We]={Type:Uint32Array,size:4,setter:V,arraySetter:P},tt[Ye]={Type:Uint32Array,size:8,setter:D},tt[He]={Type:Uint32Array,size:12,setter:w},tt[je]={Type:Uint32Array,size:16,setter:M},tt[qe]={Type:Float32Array,size:16,setter:function(e,t){return function(i){e.uniformMatrix2fv(t,!1,i)}}},tt[Ke]={Type:Float32Array,size:36,setter:function(e,t){return function(i){e.uniformMatrix3fv(t,!1,i)}}},tt[Je]={Type:Float32Array,size:64,setter:function(e,t){return function(i){e.uniformMatrix4fv(t,!1,i)}}},tt[35685]={Type:Float32Array,size:24,setter:function(e,t){return function(i){e.uniformMatrix2x3fv(t,!1,i)}}},tt[35686]={Type:Float32Array,size:32,setter:function(e,t){return function(i){e.uniformMatrix2x4fv(t,!1,i)}}},tt[35687]={Type:Float32Array,size:24,setter:function(e,t){return function(i){e.uniformMatrix3x2fv(t,!1,i)}}},tt[35688]={Type:Float32Array,size:48,setter:function(e,t){return function(i){e.uniformMatrix3x4fv(t,!1,i)}}},tt[35689]={Type:Float32Array,size:32,setter:function(e,t){return function(i){e.uniformMatrix4x2fv(t,!1,i)}}},tt[35690]={Type:Float32Array,size:48,setter:function(e,t){return function(i){e.uniformMatrix4x3fv(t,!1,i)}}},tt[35678]={Type:null,size:0,setter:U,arraySetter:G,bindPoint:3553},tt[35680]={Type:null,size:0,setter:U,arraySetter:G,bindPoint:34067},tt[35679]={Type:null,size:0,setter:U,arraySetter:G,bindPoint:32879},tt[36289]={Type:null,size:0,setter:U,arraySetter:G,bindPoint:35866};const it={};it[Pe]={size:4,setter:k},it[De]={size:8,setter:k},it[we]={size:12,setter:k},it[Me]={size:16,setter:k},it[Ue]={size:4,setter:X},it[Ge]={size:8,setter:X},it[ke]={size:12,setter:X},it[Xe]={size:16,setter:X},it[Qe]={size:4,setter:W},it[Ze]={size:8,setter:W},it[$e]={size:12,setter:W},it[et]={size:16,setter:W},it[We]={size:4,setter:X},it[Ye]={size:8,setter:X},it[He]={size:12,setter:X},it[je]={size:16,setter:X},it[qe]={size:4,setter:Y,count:2},it[Ke]={size:9,setter:Y,count:3},it[Je]={size:16,setter:Y,count:4};const rt={addExtensionsToContext:!0,attribPrefix:e=>"a"+e[0].toUpperCase()+e.substr(1)};let nt;const ot=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_color_buffer_float","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2","EXT_frag_depth","EXT_sRGB","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_depth_texture","WEBGL_draw_buffers"],st=function(){function e(e){const r=e.constructor.name;if(!t[r]){for(const t in e)if("number"==typeof e[t]){const r=i[e[t]];i[e[t]]=r?`${r} | ${t}`:t}t[r]=!0}}const t={},i={};return function(t,r){return e(t),i[r]||"0x"+r.toString(16)}}(),at=/^(.*?)_/,ut=/coord|texture/i,lt=/color|colour/i,dt=["position","positions","a_position"];const ct=document.getElementById("canvas"),_t=function(e,t){const r=["webgl","experimental-webgl"];let n=null;for(let o=0,i=r.length;o<i;o++)if(n=e.getContext(r[o],t),n){rt.addExtensionsToContext&&J(n);break}return n}(ct),v=[],T=[function(e){e=e||1;var t=[-e,-e,-e,-e,e,-e,e,-e,-e,-e,e,-e,e,e,-e,e,-e,-e,-e,-e,e,e,-e,e,-e,e,e,-e,e,e,e,-e,e,e,e,e,-e,e,-e,-e,e,e,e,e,-e,-e,e,e,e,e,e,e,e,-e,-e,-e,-e,e,-e,-e,-e,-e,e,-e,-e,e,e,-e,-e,e,-e,e,-e,-e,-e,-e,-e,e,-e,e,-e,-e,-e,e,-e,e,e,-e,e,-e,e,-e,-e,e,e,-e,e,-e,e,e,-e,e,e,e,-e,e,e,e];return{position:t,normal:[0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0]}}(1),function(e,t){e=e||1,t=t||15;for(var n,o,s,a,u,d,c=[],_=[],m=[],f=0;f<=t;f++){a=f*Se/t,d=e*ge(a),o=e*Ae(a);for(var p=0;p<=t;p++)u=2*p*Se/t,n=ge(u)*d,s=Ae(u)*d,c.push(n,o,s)}for(f=0;f<t;f++)for(p=0;p<t;p++){var h=f*(t+1)+p,v=h+t+1;_.push(c[3*h],c[3*h+1],c[3*h+2]),_.push(c[3*v],c[3*v+1],c[3*v+2]),_.push(c[3*(h+1)],c[3*(h+1)+1],c[3*(h+1)+2]),_.push(c[3*(h+1)],c[3*(h+1)+1],c[3*(h+1)+2]),_.push(c[3*v],c[3*v+1],c[3*v+2]),_.push(c[3*(v+1)],c[3*(v+1)+1],c[3*(v+1)+2]),m=m.concat(F([c[3*h],c[3*h+1],c[3*h+2]])),m=m.concat(F([c[3*v],c[3*v+1],c[3*v+2]])),m=m.concat(F([c[3*(h+1)],c[3*(h+1)+1],c[3*(h+1)+2]])),m=m.concat(F([c[3*(h+1)],c[3*(h+1)+1],c[3*(h+1)+2]])),m=m.concat(F([c[3*v],c[3*v+1],c[3*v+2]])),m=m.concat(F([c[3*(v+1)],c[3*(v+1)+1],c[3*(v+1)+2]]))}return c=null,{position:_,normal:m}}(1,40),function(e,t,n){e=e||1,t=t||1,n=n||3;for(var o=[],s=[],a=[],u=2*Se/n,d=0,c=e*e/t,_=0,m=3,f=0;f<n;f++)d=e*Ae(u*f),_=e*ge(u*f),o.push(d,-t/2,_);for(var f=0,p=o.length;f<p;f+=m){var v=(f+3)%p,T=(f+4)%p,E=(f+5)%p;s.push(0,t/2,0),s.push(o[v],o[T],o[E]),s.push(o[f],o[f+1],o[f+2]),a.push(0,1,0),a=a.concat(F([o[v],c,o[E]])),a=a.concat(F([o[f],c,o[f+2]])),s.push(0,-t/2,0),s.push(o[f],o[f+1],o[f+2]),s.push(o[v],o[T],o[E]),a.push(0,-1,0,0,-1,0,0,-1,0)}return o=null,{position:s,normal:a}}(1,3,20),function(e,t,n){e=e||1,t=t||1,n=n||3;for(var o=[],s=[],a=[],u=2*Se/n,d=0,c=0,_=6,m=0;m<n;m++)d=e*Ae(u*m),c=e*ge(u*m),o.push(d,t/2,c),o.push(d,-t/2,c);for(var m=0,f=o.length;m<f;m+=_){var p=(m+6)%f,v=(m+7)%f,T=(m+8)%f,E=(m+9)%f,y=(m+10)%f,A=(m+11)%f;s.push(0,t/2,0),s.push(o[p],o[v],o[T]),s.push(o[m],o[m+1],o[m+2]),a.push(0,1,0,0,1,0,0,1,0),s.push(o[m],o[m+1],o[m+2]),s.push(o[p],o[v],o[T]),s.push(o[m+3],o[m+4],o[m+5]),a=a.concat(F([o[m],t/2,o[m+2]])),a=a.concat(F([o[p],t/2,o[T]])),a=a.concat(F([o[m+3],-t/2,o[m+5]])),s.push(o[m+3],o[m+4],o[m+5]),s.push(o[p],o[v],o[T]),s.push(o[E],o[y],o[A]),a=a.concat(F([o[m+3],-t/2,o[m+5]])),a=a.concat(F([o[p],t/2,o[T]])),a=a.concat(F([o[E],-t/2,o[A]])),s.push(0,-t/2,0),s.push(o[m+3],o[m+4],o[m+5]),s.push(o[E],o[y],o[A]),a.push(0,-1,0,0,-1,0,0,-1,0)}return o=null,{position:s,normal:a}}(1,2,20)],mt=["cube","sphere","cone","cylinder"],ft=document.getElementById("text"),pt=ft.getContext("2d"),ht=u(),vt=[1,.1,.1,1];ft.addEventListener("mousemove",function(t){const e=L(ft,t.clientX,t.clientY);I(e,v,ht)},!1),function(){if(!_t)return;const e=te(_t,"#define GLSLIFY 1\nattribute vec4 aPosition;\nattribute vec4 aNormal;\nattribute vec2 aTexcoord;\nuniform mat4 u_vpMatrix;\nuniform mat4 u_modelMatrix;\nvarying vec3 v_normal;\nvarying vec3 v_position;\nvarying vec2 v_texcoord;\n\nvoid main() {\n  gl_Position = u_vpMatrix * u_modelMatrix * aPosition;\n  v_normal = vec3(u_modelMatrix * aNormal);\n  v_position= vec3(u_modelMatrix * aPosition);\n  v_texcoord = aTexcoord;\n}","precision mediump float;\n#define GLSLIFY 1\nuniform vec3 u_viewPosition;\nuniform vec3 u_lightPosition;\nuniform vec3 u_lightColor;\nuniform vec3 u_ambientColor;\nuniform vec3 u_specularColor;\nuniform float u_shininess;\nuniform vec4 u_color;\nvarying vec3 v_normal;\nvarying vec3 v_position;\n\nvoid main() {\n    vec3 normal = normalize(v_normal);\n    // \u73AF\u5883\u5149\n    vec3 ambient = u_ambientColor * u_color.rgb;\n    // \u5149\u7EBF\u65B9\u5411\n    vec3 lightDirection = normalize(u_lightPosition - v_position);\n    // \u5149\u7EBF\u65B9\u5411\u548C\u6CD5\u5411\u91CF\u5939\u89D2\n    float cosTheta = max(dot(lightDirection, normal), 0.0);\n    vec3 diffuse = u_lightColor * u_color.rgb * cosTheta;\n    \n    vec3 viewDirection = normalize(u_viewPosition - v_position);\n    vec3 halfwayDir = normalize(lightDirection + viewDirection);\n    float specularIntensity = pow(max(dot(normal, halfwayDir), 0.0), u_shininess);\n    vec3 specular = u_specularColor.rgb * specularIntensity;\n\n    gl_FragColor = vec4(ambient + diffuse + specular, u_color.a);\n}"),t=de(_t,e,ae(_t,O(30))),r=T.map(t=>de(_t,e,ae(_t,t)));for(let e,t=0;8>t;t++)e=S(A(y())),e[3]=3<t?(t-3)/10:1,v.push({pos:[9*ge(2*(Math.random()*Se)),5*Ae(Math.random()*Se/2)+2,5*ge(2*(Math.random()*Se))],color:e,attributes:T[t%T.length],name:mt[t%mt.length]+" "+t,select:!1});_t.clearColor(.1,.1,.1,1),_t.enable(_t.DEPTH_TEST),_t.enable(_t.CULL_FACE),R(ct),R(ft),_t.viewport(0,0,ct.width,ct.height),_t.useProgram(e.program);const n=N(ft,[0,9,15],1,50),o=c(Se/3,ct.width/ct.height,.5,100);ne(e,{u_lightPosition:[0,9,-15],u_lightColor:[1,1,1],u_ambientColor:[.8,.8,.8],u_specularColor:[1,1,1],u_shininess:20}),pt.font="28px arial",pt.lineWidth=2,pt.fillStyle="hsla(0,100%,100%,1)",pt.strokeStyle="hsla(0,100%,100%,0.7)",pt.lineCap="round",pt.lineJoin="round",function i(){const s=n(),a=l(_(s,[0,0,0],[0,1,0]));d(o,a,ht),_t.clear(_t.COLOR_BUFFER_BIT|_t.DEPTH_BUFFER_BIT),pt.clearRect(0,0,ft.width,ft.height),oe(_t,e,t),ne(e,{u_viewPosition:s,u_vpMatrix:ht,u_modelMatrix:u(),u_specularColor:[.5,.5,.5],u_color:[.25,.25,.2,1]}),_t.depthMask(!0),_t.disable(_t.BLEND),Ee(_t,t),v.forEach((t,n)=>{const i=f(ht,t.pos),o=x(i,[0,1.8,0]),s=(.5*o[0]+.5)*_t.canvas.width,a=(-.5*o[1]+.5)*_t.canvas.height;t.select&&ye({x:s,y:a,name:t.name});const u=r[n%r.length];oe(_t,e,u),ne(e,{u_modelMatrix:m(t.pos),u_color:t.select?vt:t.color}),4>n?(_t.depthMask(!0),_t.disable(_t.BLEND)):(_t.depthMask(!1),_t.enable(_t.BLEND),_t.blendFunc(_t.SRC_ALPHA,_t.ONE_MINUS_SRC_ALPHA)),Ee(_t,u)}),_t.bindVertexArray(null),requestAnimationFrame(i)}()}()})();
