function bindEvent(){$(".icon-home").live("click",function(){App.setPage("/index")})}function createIndex(e,t){t.on("click","[data-hash]",function(){var t=$(this).attr("data-hash");t&&e.setPage(t)})}function createDialog(e,t){var i=$("#loading"),a=$("#freshing"),n=t.find("#share"),s=t.find("#dialog");t.find("[data-tag=loading]").on("click",function(){i.show(),loadPercent(30),setTimeout(function(){loadPercent(100)},2e3)}),t.find("[data-tag=freshing]").on("click",function(){a.show(),setTimeout(function(){a.hide()},2e3)}),t.find("[data-tag=share]").on("click",function(){n.show()}),n.on("click",function(){n.hide()}),t.find("[data-tag=dialog]").on("click",function(){s.show()}),s.find(".btn").on("click",function(){s.hide()})}!function(){function e(e){var t={container:document.body,pageFn:function(e,t,i){this.hash=e,this.temId=t||"",this.temUrl=i||"",this.active=!1,this.elem=$('<div class="view" hash="'+e+'"></div>')},animate:{effects:["slideInRight","slideOutLeft","slideInLeft","slideOutRight"],delay:510},preLoad:function(){},aftLoad:function(){}};$.extend(t,e),this.hashSplit="/",this.con="string"==typeof t.container?$("#"+t.container):t.container,this.pageFn=t.pageFn,this.animate=t.animate,this.preLoad=t.preLoad,this.aftLoad=t.aftLoad,this.firstLoad=!0,this.isLoading=!1,this.currHash="",this.lastHash="",this.pages={},this.view={},this.otherView={},this.request={},this.hashHistory=[],this.historyCurr=-1,this.isForward=!0}e.prototype={init:function(){var e=this;return $(window).on("hashchange",function(){e.load()}),e.load(),e},load:function(){var e=this,t=e.view,i=e.otherView,a="",n=[];return e.setRequestParam(),a=e.request.hash,n=e.request.args,t[a]?e.setPage(a,n):i.hash?e.setPage(i.hash,n):"function"==typeof i&&i.call(e),e},setPage:function(e,t){var i=this,a=[],n=i.hashSplit;return t=t||"",!this.isLoading&&((String(e)+","+String(t)).replace(new RegExp("[^\\,\\s\\"+n+"]+","g"),function(e){e&&a.push(e)}),a=n+a.join(n),location.hash.substr(1)==a?this.updatePage(e):location.hash=a,this)},updatePage:function(e){var t,i,a=this,n=a.pages,s=a.view[e],r=n[e],h=n[a.currHash],o=function(){i=[a,r.elem].concat(a.request.args),a.preLoad(),s.create.apply(s,i),s.init.apply(s,i),h?a.switchEffect(r,h,function(){a.aftLoad()}):(r.elem.show(),a.aftLoad())};if(a.isLoading)return!1;if(r&&(i=[a,r.elem].concat(a.request.args)),r)h.hash!==e?(a.firstLoad=!1,a.currHash=e,a.lastHash=h.hash,a.bulidArgs(),a.preLoad(),s.init.apply(s,i),a.switchEffect(r,h,function(){a.aftLoad()})):(a.bulidArgs(),s.isParamChange&&s.init.apply(s,i));else{for(t in n){a.firstLoad=!1;break}r=new a.pageFn(e,s.temId,s.temUrl),n[e]=r,r.active=!0,a.currHash=e,a.bulidArgs(),r.temId?(r.elem.html($("#"+r.temId).html()),o()):r.temUrl&&$.ajax({url:r.temUrl,type:"GET",dataType:"html",async:!0,success:function(e){r.elem.html(e),o()}}),a.con.prepend(r.elem)}return a},pushHistory:function(){var e=this;e.hashHistory.push(e.currHash),history.pushState({lastHash:e.lastHash,currHash:e.currHash,param:e.args},document.title,location.href)},switchEffect:function(e,t,i){var a=this,n=a.isForward?a.animate.effects[0]:a.animate.effects[2],s=a.isForward?a.animate.effects[1]:a.animate.effects[3],r=a.animate.delay;return a.isLoading=!0,e.active=!0,t.active=!1,t.elem[0].className="view "+s,e.elem[0].className="view animate-start "+n,e.elem.show(),setTimeout(function(){t.elem[0].className="view",t.elem.hide(),e.elem[0].className="view",a.isLoading=!1,i()},r)},refresh:function(){var e=this,t=e.view[e.currHash],i=e.pages[e.currHash];return i&&t.init.apply(t,[e,i.elem].concat(e.request.args)),e},getHashArg:function(e){var t=e||location.hash.replace("#",""),i=this.hashSplit,a=null,n=new RegExp("\\"+i+"([^\\"+i+"]*)","g"),s=[];if(t.indexOf(i)>-1)for(;a=n.exec(t);)s.push(a[1]);return{hash:s.shift()||"",args:s}},setRequestParam:function(){return $.extend(this.request,this.getHashArg()),this},bulidArgs:function(){var e=this,t=e.view[e.currHash],i=t.args||[],a=e.request.args||[],n=i.length;t.isParamChange=!1,e.args={};for(var s=0;s<n;s++)e.args[i[s]]=a[s],t.param[i[s]]&&t.param[i[s]]!=a[s]&&(t.isParamChange=!0),t.param[i[s]]=a[s];return e},when:function(e,t){var i=this.hashView(e,t);return this.view[i.hash]=i,this},other:function(e,t){if("function"==typeof e)return this.otherView=e,this;var i=this.hashView(e,t);return i.hash&&(this.view[i.hash]=i),this.otherView=i,this},hashView:function(e,t){return $.extend({temId:"",temUrl:"",param:{},isParamChange:!1,create:function(){},init:function(){}},t,this.getHashArg(e))}},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return function(t){return new e(t)}}):"undefined"!=typeof module&&module.exports?module.exports.webApp=function(t){return new e(t)}:window.webApp=function(t){return new e(t)}}(),new FastClick(document.body);var App=webApp({container:"app",animate:{effects:["slideInRight","slideOutLeft"],delay:600},preLoad:function(){},aftLoad:function(){loadPercent(100)}}).other("/index",{temId:"tempIndex",create:createIndex}).when("/button",{temId:"tempButton"}).when("/dialog",{temId:"tempDialog",create:createDialog}).when("/form",{temId:"tempForm"}).init();bindEvent();