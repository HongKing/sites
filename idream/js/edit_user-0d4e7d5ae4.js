function destroyImg(){$(img).cropper("destroy"),$("#popImg").hide().find("img").remove(),$("#overlay").hide(),$(document).off("keydown")}function setOptionIcon(e){$("#icon")[0].className=iconHash[e]}var iconHash={1:"icon-mars",2:"icon-venus",3:"icon-mars-double",4:"icon-venus-double",5:"icon-venus-mars",6:"icon-transgender",7:"icon-neuter"},img;$("#popImg").on("click",".close",destroyImg),$("#replaceUpload").on("change",function(e){var n,t=e.target.files[0],o=t.size,a=t.type,i=$("#popImg");return["image/jpg","image/jpeg","image/png"].indexOf(a)<0?void alert("只能上传jpg和png格式的图片"):o>2097152?void alert("您上传的图片太大了，不能超过2M哦！"):void(window.FileReader?(n=new FileReader,n.onloadend=function(e){img=new Image,img.src=e.target.result,img.onload=function(){i.append(img).show(),$(img).cropper({aspectRatio:1,viewMode:1}),$("#overlay").show(),$(document).on("keydown",function(e){if(13==e.keyCode){var n=$(img).cropper("getData"),t=document.createElement("canvas"),o=t.getContext("2d");t.width=n.width,t.height=n.height,o.drawImage(img,n.x,n.y,n.width,n.height,0,0,t.width,t.height),$("#avatar").find("img").attr("src",t.toDataURL("image/jpeg")),destroyImg()}})}},n.readAsDataURL(t)):alert("浏览器不支持上传"))}),$("#avatar").on("click",function(e){$("#replaceUpload").trigger("click")}),$("#gender").on("change",function(e){setOptionIcon(this.value)}),$("#year").on(changeEvent,function(e){var n=this.value;n=n.replace(/\D+/,""),$(this).val(n)}),$("#pro,#loc").on(changeEvent,function(e){for(var n=this.value,t=0,o=0;o<n.length;o++)/[\u4e00-\u9fa5]/.test(n.charAt(o))&&t++;t>7?$(this).addClass("warn"):$(this).removeClass("warn")}),setOptionIcon($("#gender").val()),setTextHeight("name"),setTextHeight("desc");